
<body>
    <div class="container">
        <h1>ğŸ“– {{ post.title }}</h1>
        
        <div class="post-meta">
            <div style="margin-bottom: 10px;">
                <strong>ì¹´í…Œê³ ë¦¬:</strong> {{ post.get_category_display }}
                <span class="category-badge">{{ post.category }}</span>
            </div>
            <div style="margin-bottom: 10px;">
    <strong>ì‘ì„±ì:</strong>
    {% if post.author.profile.nickname %}
        {{ post.author.profile.nickname }}
    {% else %}
        {{ post.author.username|default:"ìµëª…" }}
    {% endif %}
</div>
            <div style="margin-bottom: 10px;">
                <strong>ì‘ì„±ì¼:</strong> {{ post.created_at|date:"Yë…„ mì›” dì¼ H:i" }}
            </div>
            <div style="margin-bottom: 10px;">
                <strong>ì¡°íšŒìˆ˜:</strong> {{ post.views }}íšŒ
            </div>
            {% if post.updated_at != post.created_at %}
            <div>
                <strong>ìˆ˜ì •ì¼:</strong> {{ post.updated_at|date:"Yë…„ mì›” dì¼ H:i" }}
            </div>
            {% endif %}
        </div>
        
        <div class="post-content">
            {{ post.content|linebreaks }}
        </div>

        {% if post.image %}
        <div class="post-image">
            <img src="{{ post.image.url }}" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€">
        </div>
        {% endif %}
        
<!-- ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ -->
<h3 style="margin-top: 40px;">ğŸ’¬ ëŒ“ê¸€</h3>
<div>
    {% for comment in post.comments.all %}
        {% if not comment.parent %}
            <div style="margin: 20px 0; padding: 10px; border-left: 3px solid #667eea;">
                <strong>
                    {% if comment.author.profile.nickname %}
                        {{ comment.author.profile.nickname }}
                    {% else %}
                        {{ comment.author.username }}
                    {% endif %}
                </strong>
                | {{ comment.created_at|date:"Y.m.d H:i" }}
                <p>{{ comment.content|linebreaks }}</p>

                {% if user == comment.author %}
                    <a href="{% url 'edit_comment' comment.id %}">âœï¸ ìˆ˜ì •</a>
                    <a href="{% url 'delete_comment' comment.id %}">ğŸ—‘ï¸ ì‚­ì œ</a>
                {% endif %}

                <form action="{% url 'add_comment' post.id %}" method="POST" style="margin-top: 10px;">
                    {% csrf_token %}
                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                    <textarea name="content" rows="1" placeholder="ë‹µê¸€ ì…ë ¥..." style="width:100%;"></textarea>
                    <button type="submit">ë‹µê¸€</button>
                </form>

                {% for reply in comment.replies.all %}
                    <div style="margin-left: 30px; margin-top: 10px; padding-left: 10px; border-left: 2px solid #aaa;">
                        <strong>
                            {% if reply.author.profile.nickname %}
                                {{ reply.author.profile.nickname }}
                            {% else %}
                                {{ reply.author.username }}
                            {% endif %}
                        </strong>
                        | {{ reply.created_at|date:"Y.m.d H:i" }}
                        <p>{{ reply.content|linebreaks }}</p>
                        {% if user == reply.author %}
                            <a href="{% url 'delete_comment' reply.id %}">ì‚­ì œ</a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% empty %}
        <p>ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}
</div>


<!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
<h4 style="margin-top: 30px;">âœï¸ ëŒ“ê¸€ ì‘ì„±</h4>
<form action="{% url 'add_comment' post.id %}" method="POST">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">ëŒ“ê¸€ ë‹¬ê¸°</button>
</form>



        <div class="navigation">
            <a href="{% url 'blog_list' %}" class="btn btn-secondary">ğŸ“‹ ëª©ë¡ìœ¼ë¡œ</a>
            {% if user.is_authenticated and user == post.author %}
                <a href="{% url 'post_edit' post.id %}" class="btn btn-warning">âœï¸ ìˆ˜ì •</a>
                <a href="{% url 'post_delete' post.id %}" class="btn btn-danger" 
                   onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ğŸ—‘ï¸ ì‚­ì œ</a>
            {% endif %}
            <a href="/" class="btn btn-primary">ğŸ  í™ˆìœ¼ë¡œ</a>
        </div>
    </div>
</body>
</html>
