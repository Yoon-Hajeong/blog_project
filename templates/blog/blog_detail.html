
<body>
    <div class="container">
        <h1>📖 {{ post.title }}</h1>
        
        <div class="post-meta">
            <div style="margin-bottom: 10px;">
                <strong>카테고리:</strong> {{ post.get_category_display }}
                <span class="category-badge">{{ post.category }}</span>
            </div>
            <div style="margin-bottom: 10px;">
    <strong>작성자:</strong>
    {% if post.author.profile.nickname %}
        {{ post.author.profile.nickname }}
    {% else %}
        {{ post.author.username|default:"익명" }}
    {% endif %}
</div>
            <div style="margin-bottom: 10px;">
                <strong>작성일:</strong> {{ post.created_at|date:"Y년 m월 d일 H:i" }}
            </div>
            <div style="margin-bottom: 10px;">
                <strong>조회수:</strong> {{ post.views }}회
            </div>
            {% if post.updated_at != post.created_at %}
            <div>
                <strong>수정일:</strong> {{ post.updated_at|date:"Y년 m월 d일 H:i" }}
            </div>
            {% endif %}
        </div>
        
        <div class="post-content">
            {{ post.content|linebreaks }}
        </div>

        {% if post.image %}
        <div class="post-image">
            <img src="{{ post.image.url }}" alt="게시글 이미지">
        </div>
        {% endif %}
        
<!-- 댓글 리스트 -->
<h3 style="margin-top: 40px;">💬 댓글</h3>
<div>
    {% for comment in post.comments.all %}
        {% if not comment.parent %}
            <div style="margin: 20px 0; padding: 10px; border-left: 3px solid #667eea;">
                <strong>
                    {% if comment.author.profile.nickname %}
                        {{ comment.author.profile.nickname }}
                    {% else %}
                        {{ comment.author.username }}
                    {% endif %}
                </strong>
                | {{ comment.created_at|date:"Y.m.d H:i" }}
                <p>{{ comment.content|linebreaks }}</p>

                {% if user == comment.author %}
                    <a href="{% url 'edit_comment' comment.id %}">✏️ 수정</a>
                    <a href="{% url 'delete_comment' comment.id %}">🗑️ 삭제</a>
                {% endif %}

                <form action="{% url 'add_comment' post.id %}" method="POST" style="margin-top: 10px;">
                    {% csrf_token %}
                    <input type="hidden" name="parent_id" value="{{ comment.id }}">
                    <textarea name="content" rows="1" placeholder="답글 입력..." style="width:100%;"></textarea>
                    <button type="submit">답글</button>
                </form>

                {% for reply in comment.replies.all %}
                    <div style="margin-left: 30px; margin-top: 10px; padding-left: 10px; border-left: 2px solid #aaa;">
                        <strong>
                            {% if reply.author.profile.nickname %}
                                {{ reply.author.profile.nickname }}
                            {% else %}
                                {{ reply.author.username }}
                            {% endif %}
                        </strong>
                        | {{ reply.created_at|date:"Y.m.d H:i" }}
                        <p>{{ reply.content|linebreaks }}</p>
                        {% if user == reply.author %}
                            <a href="{% url 'delete_comment' reply.id %}">삭제</a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% empty %}
        <p>아직 댓글이 없습니다.</p>
    {% endfor %}
</div>


<!-- 댓글 작성 폼 -->
<h4 style="margin-top: 30px;">✏️ 댓글 작성</h4>
<form action="{% url 'add_comment' post.id %}" method="POST">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">댓글 달기</button>
</form>



        <div class="navigation">
            <a href="{% url 'blog_list' %}" class="btn btn-secondary">📋 목록으로</a>
            {% if user.is_authenticated and user == post.author %}
                <a href="{% url 'post_edit' post.id %}" class="btn btn-warning">✏️ 수정</a>
                <a href="{% url 'post_delete' post.id %}" class="btn btn-danger" 
                   onclick="return confirm('정말 삭제하시겠습니까?')">🗑️ 삭제</a>
            {% endif %}
            <a href="/" class="btn btn-primary">🏠 홈으로</a>
        </div>
    </div>
</body>
</html>
